{% extends "base.html" %}
{% block title %}Restaurant profile{% endblock %}

{% block main %}
<h1>{{ name }}</h1>


<h3 class="ui header">
    <i class="star icon"></i>
    <div class="content">
        {{ average_rating }}
    </div>
</h3>

<h3 class="ui header">
    <i class="phone icon"></i>
    <div class="content">
        Phone: {{ phone }}
    </div>
</h3>


<h3 class="ui header">
    <i class="clock outline icon"></i>
    <div class="content">
        Opening hours: {{ open }} - {{ close}}
    </div>
</h3>


<h3 class="ui header">
    <i class="flag outline icon"></i>
    <div class="content">
        Cuisine type: {{ cuisine }}
    </div>
</h3>

{% if current_user.is_authenticated %}

{% if session["role"] == "operator" %}
<a href="{{base_url}}/reservations" class="positive ui button">See reservations</a>
{% endif %}

{% if session["role"] != "operator" and session["role"] != "authority" %}
<a href="{{base_url}}/book_table" class="positive ui button">Book a table!</a>
{% endif %}
{% endif %}
<ul>
    <iframe width="600" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
        src="https://www.openstreetmap.org/export/embed.html?bbox={{ lon - 0.001 }}%2C{{ lat - 0.001 }}%2C{{ lon + 0.001 }}%2C{{ lat + 0.001 }}&amp;layer=mapnik&amp;marker={{ lat }}%2C{{ lon }}"
        style="border: 1px solid black"></iframe><br /><small><a
            href="https://www.openstreetmap.org/#map=17/{{ lat }}/{{ lon }}">See it Larger</a></small>

</ul>

<section>
    <h3 class="ui dividing header">
        <i class="heart outline icon"></i>
        <div class="content">
            Anti Covid-19 Precautions
        </div>
    </h3>
    <ul>
        {% for precaution in precautions %}
        <li>
            {{ precaution }}
        </li>
        {% endfor %}
    </ul>
</section>

<section>
    <h3 class="ui dividing header">
        <i class="book icon"></i>
        <div class="content">
            Menus
        </div>
    </h3>
    <ul>
        {% for menu in menus: %}
        <li>
            <a href="{{base_url}}/menus/show/{{menu.id}}">{{menu.name}}</a>
        </li>
        {% endfor %}
    </ul>
    {% if session['role'] == 'operator' and current_user.id == operator_id %}
    <a href="/restaurants/{{id}}/menus/new" class="ui primary button">
        <i class="plus icon"></i>
        Add a menu
    </a>
    {% endif %}
</section>

<section>
    <h3 class="ui dividing header">
        <div class="content">
            Photos
        </div>
    </h3>
    {% if session['role'] == 'operator' and current_user.id == operator_id %}
    <a href="/restaurants/{{ id }}/upload" class="ui primary button">
        <i class="plus icon"></i>
        Upload photos
    </a>
    {% endif %}
</section>

<div class="ui divider"></div>
<article>
    <h3 class="ui dividing header">
        <i class="star outline icon"></i>
        <div class="content">
            Reviews
        </div>
    </h3>
    {% if not reviews %}
    <h2 class="ui icon header center aligned disabled">
        <i class="comments icon"></i>
        <div class="ui tiny header">No reviews yet</div>
    </h2>
    </div>
    {% endif %}
    {% for review in reviews %}
    <section>
        <div class="ui medium comments">
            <div class="comment">
                <a class="avatar">
                    <img loading="lazy" src={{ review.user.get_avatar_link() }}>
                </a>
                <div class="content">
                    <div class="author">{{ review.user.firstname }}</div>
                    <div class="metadata">
                        <div class="date">{{ review.created.strftime("%d %B %Y") }}</div>
                        <div class="rating">
                            <i class="star icon"></i>
                            {{ review.rating }}
                        </div>
                    </div>
                    <div class="text">
                        {{ review.message }}
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endfor %}
    <div class="ui hidden section divider"></div>
    {% if session["role"] != "operator" and session["role"] != "authority" %}
    <section>
        <form class="ui form" method="POST">
            <h3 class="ui header">Add your review</h3>
            {{ form.hidden_tag() }}
            {% for field in form.display %}
            <div class="field">
                <label>{{ form[field].label }}</label>
                {{ form[field]() }}
            </div>
            {% if form[field].errors %}
            {% for e in form[field].errors %}
            <p class="help-block">{{ e }}</p>
            {% endfor %}
            {% endif %}
            {% endfor %}
            <button class="ui button primary labeled icon button" type="submit"><i class="icon edit"></i> Add
                Review</button>
        </form>
        {% endif %}
    </section>
    {% endblock %}