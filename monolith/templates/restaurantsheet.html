{% extends "base.html" %}
{% block title %}Restaurant profile{% endblock %}

{% block main %}
<h1>{{ name }} -- Likes: {{ likes }}</h1>
<h2>Phone: {{ phone }}</h2>
<h3>Opening hours: {{ open }} Closing hours: {{ close}}</h3>
<h3>Cuisine type: {{ cuisine }} </h3>
<ul>
    {% if current_user.is_authenticated %}
    <iframe width="600" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
        src="https://www.openstreetmap.org/export/embed.html?bbox={{ lon - 0.001 }}%2C{{ lat - 0.001 }}%2C{{ lon + 0.001 }}%2C{{ lat + 0.001 }}&amp;layer=mapnik&amp;marker={{ lat }}%2C{{ lon }}"
        style="border: 1px solid black"></iframe><br /><small><a
            href="https://www.openstreetmap.org/#map=17/{{ lat }}/{{ lon }}">See it Larger</a></small>
    <form action="{{base_url}}/book_table">
        <button type="submit">Book!</button>
    </form>
    {% endif %}
</ul>

<section>
    <h3>Precautions:</h3>
    <ul>
        {% for precaution in precautions %}
        <li>
            {{ precaution }}
        </li>
        {% endfor %}
    </ul>
</section>
<div class="ui divider"></div>
<article>
    <h2 class="ui header">Reviews</h2>
    {% if not reviews %}
    <h2 class="ui icon header center aligned disabled">
        <i class="comments icon"></i>
        <div class="ui tiny header">No reviews yet</div>
    </h2>
    </div>
    {% endif %}
    {% for review in reviews %}
    <section>
        <div class="ui medium comments">
            <div class="comment">
                <a class="avatar">
                    <img loading="lazy" src={{ review.user.get_avatar_link() }}>
                </a>
                <div class="content">
                    <div class="author">{{ review.user.firstname }}</div>
                    <div class="metadata">
                        <div class="date">{{ review.created.strftime("%d %B %Y") }}</div>
                        <div class="rating">
                            <i class="star icon"></i>
                            {{ review.rating }}
                        </div>
                    </div>
                    <div class="text">
                        {{ review.message }}
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endfor %}
    <div class="ui hidden section divider"></div>
    {% if session["role"] != "operator" and session["role"] != "authority" %}
    <section>
        <form class="ui form" method="POST">
            <h3 class="ui header">Add your review</h3>
            {{ form.hidden_tag() }}
            {% for field in form.display %}
            <div class="field">
                <label>{{ form[field].label }}</label>
                {{ form[field]() }}
            </div>
            {% if form[field].errors %}
            {% for e in form[field].errors %}
            <p class="help-block">{{ e }}</p>
            {% endfor %}
            {% endif %}
            {% endfor %}
            <button class="ui button primary labeled icon button" type="submit"><i class="icon edit"></i> Add
                Review</button>
        </form>
    </section>

    <article>
        <h3>Reviews</h3>
        <!--Insert if empty check-->
        {% for review in reviews %}
        <section>
            <h5>{{ review.user.firstname }}, rating: {{ review.rating }}</h5>
            <p>{{ review.message }}</p>
        </section>
        {% endfor %}
        {% if session["role"] != "operator" and session["role"] != "authority" %}
        <section>
            <form method="POST">
                <h3>Add your review</h3>
                {{ form.hidden_tag() }}
                <p>
                    {% if form.rating.errors %}
                <ul class=errors>
                    {% for error in form.rating.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                <label for="">
                    <span>{{ form.rating.label }}</span>
                </label> {{ form.rating() }}
                </p>
                <p>
                    {% if form.message.errors %}
                <ul>
                    {% for error in form.message.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                <label for="Message">
                    <span>{{ form.message.label }}</span>
                </label>
                {{ form.message() }}
                </p>
                <p>
                    <input type="submit" value="Post">
                </p>
            </form>
        </section>
        {% endif %}
    </article>

    <h3>Menus:</h3>
    <ul>
        {% for menu in menus: %}
        <li>
            {{menu.name}}
            <a href="{{base_url}}/show_menu/{{menu.id}}">Show details</a>
        </li>
        {% endfor %}
    </ul>
    <a href="/operator/restaurants/{{id}}/create_menu">Create new menu</a>
    {% endblock %}